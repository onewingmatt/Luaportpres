<!DOCTYPE html>
<html>
<head>
    <title>President Card Game</title>
    <meta charset="UTF-8">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1e3c72; color: #fff; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .tab-buttons { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        .tab-button { padding: 10px 20px; background: #444; color: #fff; border: none; cursor: pointer; border-radius: 5px; }
        .tab-button.active { background: #2ecc71; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { padding: 10px; border: none; border-radius: 5px; width: 100%; }
        .form-group button { padding: 10px 20px; background: #3498db; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .info-panel { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; margin: 15px 0; }
        .info-panel h3 { color: #2ecc71; margin-bottom: 10px; }
        .players-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .player-card { background: rgba(0,0,0,0.5); padding: 15px; border-radius: 5px; border: 2px solid #666; }
        .player-card.active { border-color: #2ecc71; background: rgba(46,204,113,0.2); box-shadow: 0 0 15px #2ecc71; }
        .player-indicator { color: #2ecc71; font-weight: bold; font-size: 16px; margin-top: 5px; }
        .card { display: inline-block; margin: 3px; padding: 8px 12px; border-radius: 3px; cursor: pointer; font-weight: bold; border: 2px solid; }
        .card.black { color: #000; background: #888; border-color: #555; }
        .card.red { color: #e74c3c; background: #fff; border-color: #999; }
        .card.selected { border-color: #ffd700; background: #ffd700; color: #000; box-shadow: 0 0 5px #ffd700; }
        .button-group { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        .button-group button { flex: 1; min-width: 100px; padding: 10px; background: #27ae60; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        .checkbox-group { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; }
        .checkbox-group label { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .status-box { background: rgba(46,204,113,0.2); border: 3px solid #2ecc71; padding: 15px; border-radius: 5px; margin: 10px 0; font-weight: bold; font-size: 18px; color: #2ecc71; display: none; }
        h1 { text-align: center; margin-bottom: 20px; }
        h2 { color: #2ecc71; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ® President Card Game</h1>

        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab(event, 'create')">Create</button>
            <button class="tab-button" onclick="showTab(event, 'join')">Join</button>
            <button class="tab-button" onclick="showTab(event, 'play')">Play</button>
        </div>

        <div id="create" class="tab-content active">
            <h2>Create Game</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="createName" value="Player">
            </div>
            <div class="form-group">
                <label>CPUs</label>
                <select id="cpuCount">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                </select>
            </div>
            <div class="form-group">
                <label>Options</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="wild2s" checked> 2s Wild</label>
                    <label><input type="checkbox" id="wildBlack3s" checked> Black 3s</label>
                    <label><input type="checkbox" id="wildJd" checked> JD Wild</label>
                </div>
            </div>
            <div class="form-group">
                <button onclick="createGame()">Create Game</button>
            </div>
        </div>

        <div id="join" class="tab-content">
            <h2>Join Game</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="joinName" value="Player">
            </div>
            <div class="form-group">
                <label>Game ID</label>
                <input type="text" id="gameIdInput">
            </div>
            <div class="form-group">
                <button onclick="joinGame()">Join</button>
            </div>
        </div>

        <div id="play" class="tab-content">
            <h2>Game</h2>
            <div class="info-panel">
                <h3>Status</h3>
                <div>Game: <strong id="gameId">-</strong></div>
                <div id="statusBox" class="status-box">ðŸŸ¢ Your Turn!</div>
            </div>
            <div class="info-panel">
                <h3>Players</h3>
                <div id="playersList" class="players-grid"></div>
            </div>
            <div class="info-panel">
                <h3>Table</h3>
                <div id="tableMeld">-</div>
            </div>
            <div class="info-panel">
                <h3>Hand</h3>
                <div id="hand"></div>
            </div>
            <div class="button-group">
                <button onclick="playMeld()">Play</button>
                <button onclick="clearSelection()" style="background: #95a5a6;">Clear</button>
                <button onclick="passTurn()" style="background: #e74c3c;">Pass</button>
            </div>
            <div class="form-group">
                <button onclick="dealCards()" style="width: 100%; padding: 15px; background: #f39c12; color: #000; font-weight: bold;">Deal & Start</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let gameId = null, playerId = null, selectedCards = [], currentHand = [];

        socket.on('connected', () => console.log('Connected'));
        socket.on('game_created', (d) => { gameId = d.game_id; document.getElementById('gameId').textContent = gameId; showTab(null, 'play'); });
        socket.on('game_joined', (d) => { gameId = d.game_id; playerId = d.player_name; currentHand = d.hand; updateHand(d.hand); updatePlayers(d.players_status); showTab(null, 'play'); });
        socket.on('cards_dealt', (d) => { currentHand = d.hand; updateHand(d.hand); updatePlayers(d.players_status); });
        socket.on('game_started', (d) => updatePlayers(d.players_status));
        socket.on('meld_played', (d) => { updatePlayers(d.players_status); });
        socket.on('player_passed', (d) => updatePlayers(d.players_status));
        socket.on('turn_update', (d) => { updatePlayers(d.players_status); checkIfYourTurn(d.players_status); });
        socket.on('player_joined', (d) => updatePlayers(d.players_status));
        socket.on('table_cleared', (d) => { document.getElementById('tableMeld').textContent = '-'; updatePlayers(d.players_status); });
        socket.on('error', (d) => alert('Error: ' + d.message));

        function updateHand(hand) {
            const div = document.getElementById('hand');
            if (!hand || !hand.length) { div.innerHTML = '<div style="color: #aaa;">No cards</div>'; return; }
            currentHand = hand;
            div.innerHTML = hand.map((c, i) => {
                const isBlack = c.suit === 'â™ ' || c.suit === 'â™£';
                const sel = selectedCards.some(x => x.rank === c.rank && x.suit === c.suit);
                const cls = 'card ' + (isBlack ? 'black' : 'red') + (sel ? ' selected' : '');
                return '<span class="' + cls + '" onclick="toggleCard(' + i + ', ' + JSON.stringify(c).replace(/"/g, '&quot;') + ')">' + c.rank + c.suit + '</span>';
            }).join('');
        }

        function updatePlayers(status) {
            const div = document.getElementById('playersList');
            if (!status) return;
            div.innerHTML = status.map(p => {
                const act = p.is_active ? 'player-card active' : 'player-card';
                const ind = p.is_active ? 'ðŸŸ¢ ACTIVE' : (p.is_leader ? 'ðŸ‘‘ LEADER' : '');
                return '<div class="' + act + '"><div style="font-weight: bold;">' + p.name + '</div><div style="font-size: 12px; color: #aaa;">Cards: ' + p.card_count + '</div><div style="font-size: 11px; color: #ffd700;">' + (p.is_cpu ? 'CPU' : 'HUMAN') + '</div><div class="player-indicator">' + ind + '</div></div>';
            }).join('');
        }

        function checkIfYourTurn(status) {
            const box = document.getElementById('statusBox');
            box.style.display = (status && status.some(p => p.name === playerId && p.is_active)) ? 'block' : 'none';
        }

        function toggleCard(i, c) {
            const f = selectedCards.findIndex(x => x.rank === c.rank && x.suit === c.suit);
            f >= 0 ? selectedCards.splice(f, 1) : selectedCards.push(c);
            updateHand(currentHand);
        }

        function createGame() { socket.emit('create', { name: document.getElementById('createName').value || 'Player', cpus: parseInt(document.getElementById('cpuCount').value), options: { wild_2s: document.getElementById('wild2s').checked, wild_black3: document.getElementById('wildBlack3s').checked, wild_jd: document.getElementById('wildJd').checked } }); }
        function dealCards() { socket.emit('deal_cards'); }
        function joinGame() { const g = document.getElementById('gameIdInput').value; if (!g) { alert('Enter ID'); return; } socket.emit('join_game', { game_id: g, player_name: document.getElementById('joinName').value || 'Player' }); }
        function playMeld() { if (!selectedCards.length) { alert('Select cards'); return; } socket.emit('play_meld', { cards: selectedCards }); selectedCards = []; }
        function passTurn() { socket.emit('pass_turn'); }
        function clearSelection() { selectedCards = []; updateHand(currentHand); }
        function showTab(e, t) { document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active')); document.querySelectorAll('.tab-button').forEach(x => x.classList.remove('active')); document.getElementById(t).classList.add('active'); if (e && e.target) e.target.classList.add('active'); }
    </script>
</body>
</html>