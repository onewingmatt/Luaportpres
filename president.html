<!DOCTYPE html>
<html>
<head>
    <title>President Card Game</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            padding: 10px;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }

        .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-button { padding: 12px 24px; background: #444; color: #fff; border: none; cursor: pointer; border-radius: 5px; font-size: 1em; font-weight: bold; }
        .tab-button.active { background: #2ecc71; }
        .tab-button:hover { background: #555; }
        .tab-button.active:hover { background: #27ae60; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { padding: 10px; border: none; border-radius: 5px; width: 100%; font-size: 1em; }
        .form-group button { padding: 12px 20px; background: #3498db; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1em; }
        .form-group button:hover { background: #2980b9; }

        .info-panel { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 5px; margin: 15px 0; }
        .info-panel h3 { margin-bottom: 15px; color: #2ecc71; font-size: 1.2em; }

        .players-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0; }
        .player-card { background: rgba(0,0,0,0.5); padding: 15px; border-radius: 5px; border: 2px solid #666; text-align: center; }
        .player-card.active { border-color: #2ecc71; background: rgba(46, 204, 113, 0.2); box-shadow: 0 0 15px #2ecc71; }
        .player-name { font-weight: bold; margin-bottom: 8px; font-size: 1.1em; }
        .player-cards { font-size: 0.9em; color: #aaa; margin-bottom: 5px; }
        .player-role { font-size: 0.85em; color: #ffd700; margin-bottom: 5px; }
        .player-indicator { color: #2ecc71; font-weight: bold; margin-top: 8px; font-size: 1.2em; }

        .card-display { font-size: 18px; font-weight: bold; display: inline-block; margin: 3px; padding: 8px 12px; border-radius: 3px; cursor: pointer; border: 2px solid #999; }
        .card-display.black { color: #000; background: #888; }
        .card-display.red { color: #e74c3c; background: #fff; }
        .card-display.selected { border-color: #ffd700; background: #ffd700; color: #000; box-shadow: 0 0 5px #ffd700; }

        .button-group { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        .button-group button { flex: 1; min-width: 120px; padding: 12px; background: #27ae60; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1em; }
        .button-group button:hover { background: #229954; }
        .button-group button.secondary { background: #95a5a6; }
        .button-group button.secondary:hover { background: #7f8c8d; }
        .button-group button.danger { background: #e74c3c; }
        .button-group button.danger:hover { background: #c0392b; }

        .log { background: #000; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; font-size: 12px; font-family: monospace; line-height: 1.4; }
        .log-line { margin: 3px 0; }
        .log-success { color: #2ecc71; }
        .log-info { color: #ffd700; }
        .log-error { color: #e74c3c; }

        .checkbox-group { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; }
        .checkbox-group label { margin: 0; display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal; }
        .checkbox-group input { width: auto; cursor: pointer; }

        .status-box { background: rgba(46, 204, 113, 0.2); border: 3px solid #2ecc71; padding: 15px; border-radius: 5px; margin: 10px 0; font-weight: bold; font-size: 1.3em; color: #2ecc71; text-align: center; display: none; }
        .status-box.show { display: block; }

        h2 { color: #2ecc71; margin-top: 20px; margin-bottom: 15px; }

        .hand-container { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; min-height: 100px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ® President Card Game</h1>
        </div>

        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab(event, 'create')">Create Game</button>
            <button class="tab-button" onclick="showTab(event, 'join')">Join Game</button>
            <button class="tab-button" onclick="showTab(event, 'play')">Play</button>
            <button class="tab-button" onclick="showTab(event, 'options')">âš™ Options</button>
        </div>

        <div id="create" class="tab-content active">
            <h2>Create New Game</h2>
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="createName" placeholder="Enter your name" value="Player">
            </div>
            <div class="form-group">
                <label>Number of CPUs</label>
                <select id="cpuCount">
                    <option value="1">1 CPU</option>
                    <option value="2">2 CPUs</option>
                    <option value="3" selected>3 CPUs</option>
                </select>
            </div>
            <div class="form-group">
                <label>Game Options</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="wild2s" checked> 2s Wild</label>
                    <label><input type="checkbox" id="wildBlack3s" checked> Black 3s Wild</label>
                    <label><input type="checkbox" id="wildJd" checked> JD Wild</label>
                </div>
            </div>
            <div class="form-group">
                <button onclick="createGame()">Create Game</button>
            </div>
        </div>

        <div id="join" class="tab-content">
            <h2>Join Existing Game</h2>
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="joinName" placeholder="Enter your name" value="Player">
            </div>
            <div class="form-group">
                <label>Game ID</label>
                <input type="text" id="gameIdInput" placeholder="Enter game ID">
            </div>
            <div class="form-group">
                <button onclick="joinGame()">Join Game</button>
            </div>
        </div>

        <div id="play" class="tab-content">
            <h2>Playing Game</h2>

            <div class="info-panel">
                <h3>Current Status</h3>
                <div>Game ID: <strong id="gameId">-</strong></div>
                <div>Current Player: <strong id="currentPlayer">-</strong></div>
                <div id="statusBox" class="status-box">ðŸŸ¢ It is YOUR TURN!</div>
            </div>

            <div class="info-panel">
                <h3>Players</h3>
                <div id="playersList" class="players-grid"></div>
            </div>

            <div class="info-panel">
                <h3>Table Meld</h3>
                <div id="tableMeld" style="font-size: 18px; font-weight: bold; min-height: 40px; display: flex; align-items: center;">-</div>
            </div>

            <div class="info-panel">
                <h3>Your Hand (Click to select)</h3>
                <div id="hand" class="hand-container"></div>
            </div>

            <div class="button-group">
                <button onclick="playMeld()">Play Selected</button>
                <button class="secondary" onclick="clearSelection()">Clear</button>
                <button class="danger" onclick="passTurn()">Pass</button>
            </div>

            <div class="info-panel">
                <h3>Start Game</h3>
                <button onclick="dealCards()" style="width: 100%; padding: 15px; background: #f39c12; font-size: 1.1em; color: #000; font-weight: bold;">Deal Cards & Start Game</button>
            </div>
        </div>

        <div id="options" class="tab-content">
            <h2>Game Options</h2>
            <div class="info-panel">
                <h3>Rules</h3>
                <div class="checkbox-group" style="flex-direction: column; align-items: flex-start;">
                    <label><input type="checkbox" id="opt2s"> 2s Wild</label>
                    <label><input type="checkbox" id="optBlack3s"> Black 3s Wild</label>
                    <label><input type="checkbox" id="optJd"> JD Wild</label>
                </div>
            </div>

            <div class="info-panel">
                <h3>Debug Log</h3>
                <div id="log" class="log"></div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let gameId = null;
        let playerId = null;
        let selectedCards = [];
        let currentHand = [];

        socket.on('connected', () => { console.log('Connected to server'); });

        socket.on('game_created', (data) => {
            gameId = data.game_id;
            addLog(`Game created: ${gameId}`, 'success');
            document.getElementById('gameId').textContent = gameId;
            showTab(null, 'play');
        });

        socket.on('game_joined', (data) => {
            gameId = data.game_id;
            playerId = data.player_name;
            addLog(`Joined game: ${gameId}`, 'success');
            document.getElementById('gameId').textContent = gameId;
            currentHand = data.hand;
            updateHand(data.hand);
            updatePlayers(data.players_status);
            showTab(null, 'play');
        });

        socket.on('cards_dealt', (data) => {
            currentHand = data.hand;
            updateHand(data.hand);
            updatePlayers(data.players_status);
            addLog('Cards dealt!', 'success');
        });

        socket.on('game_started', (data) => {
            updatePlayers(data.players_status);
            addLog('Game started!', 'info');
        });

        socket.on('meld_played', (data) => {
            addLog(`${data.player} played`, 'info');
            document.getElementById('tableMeld').innerHTML = formatMeldDisplay(data.cards_str);
            updatePlayers(data.players_status);
            if (data.my_hand) {
                currentHand = data.my_hand;
                updateHand(data.my_hand);
            }
        });

        socket.on('player_passed', (data) => {
            addLog(`${data.player} passed`, 'info');
            updatePlayers(data.players_status);
        });

        socket.on('turn_update', (data) => {
            updatePlayers(data.players_status);
            checkIfYourTurn(data.players_status);
        });

        socket.on('player_joined', (data) => {
            addLog(`${data.player_name} joined!`, 'success');
            updatePlayers(data.players_status);
        });

        socket.on('table_cleared', (data) => {
            document.getElementById('tableMeld').textContent = '-';
            updatePlayers(data.players_status);
            addLog('Table cleared', 'info');
        });

        socket.on('error', (data) => {
            addLog(`Error: ${data.message}`, 'error');
        });

        function formatMeldDisplay(cardsStr) {
            return cardsStr.split(' ').map(card => {
                const rank = card.slice(0, -1);
                const suit = card.slice(-1);
                const isBlack = suit === 'â™ ' || suit === 'â™£';
                const className = isBlack ? 'card-display black' : 'card-display red';
                return `<span class="${className}">${rank}${suit}</span>`;
            }).join('');
        }

        function updateHand(hand) {
            const handDiv = document.getElementById('hand');
            if (!hand || hand.length === 0) {
                handDiv.innerHTML = '<div style="color: #aaa; padding: 20px; text-align: center;">No cards</div>';
                return;
            }
            currentHand = hand;
            handDiv.innerHTML = hand.map((card, idx) => {
                const rank = card.rank;
                const suit = card.suit;
                const isBlack = suit === 'â™ ' || suit === 'â™£';
                const selected = selectedCards.some(c => c.rank === rank && c.suit === suit);
                const className = `card-display ${isBlack ? 'black' : 'red'} ${selected ? 'selected' : ''}`;
                return `<span class="${className}" onclick="toggleCard(${idx}, ${JSON.stringify(card).replace(/"/g, '&quot;')})">${rank}${suit}</span>`;
            }).join('');
        }

        function updatePlayers(status) {
            const listDiv = document.getElementById('playersList');
            if (!status) return;
            listDiv.innerHTML = status.map(p => {
                const isActive = p.is_active;
                const className = isActive ? 'player-card active' : 'player-card';
                const indicator = isActive ? 'ðŸŸ¢ ACTIVE' : (p.is_leader ? 'ðŸ‘‘ LEADER' : '');
                return `<div class="${className}">
                    <div class="player-name">${p.name}</div>
                    <div class="player-cards">Cards: ${p.card_count}</div>
                    <div class="player-role">${p.is_cpu ? 'CPU' : 'HUMAN'}</div>
                    <div class="player-indicator">${indicator}</div>
                </div>`;
            }).join('');
        }

        function checkIfYourTurn(status) {
            const box = document.getElementById('statusBox');
            const yourTurn = status && status.some(p => p.name === playerId && p.is_active);
            if (yourTurn) {
                box.classList.add('show');
            } else {
                box.classList.remove('show');
            }
        }

        function toggleCard(idx, card) {
            const found = selectedCards.findIndex(c => c.rank === card.rank && c.suit === card.suit);
            if (found >= 0) {
                selectedCards.splice(found, 1);
            } else {
                selectedCards.push(card);
            }
            updateHand(currentHand);
        }

        function createGame() {
            const name = document.getElementById('createName').value || 'Player';
            const cpus = document.getElementById('cpuCount').value;
            const options = {
                wild_2s: document.getElementById('wild2s').checked,
                wild_black3: document.getElementById('wildBlack3s').checked,
                wild_jd: document.getElementById('wildJd').checked
            };
            socket.emit('create', {
                name: name,
                cpus: parseInt(cpus),
                options: options
            });
        }

        function dealCards() {
            socket.emit('deal_cards');
        }

        function joinGame() {
            const name = document.getElementById('joinName').value || 'Player';
            const gid = document.getElementById('gameIdInput').value;
            if (!gid) {
                addLog('Please enter a game ID', 'error');
                return;
            }
            socket.emit('join_game', {
                game_id: gid,
                player_name: name
            });
        }

        function playMeld() {
            if (selectedCards.length === 0) {
                addLog('Select cards first', 'error');
                return;
            }
            socket.emit('play_meld', { cards: selectedCards });
            selectedCards = [];
        }

        function passTurn() {
            socket.emit('pass_turn');
        }

        function clearSelection() {
            selectedCards = [];
            updateHand(currentHand);
        }

        function addLog(msg, type = 'info') {
            const log = document.getElementById('log');
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
        }

        function showTab(event, tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }
    </script>
</body>
</html>