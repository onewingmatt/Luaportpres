<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>President Card Game</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #1a5f1f;
            color: #fff;
            padding: 10px;
            overflow: hidden;
        }

        #createGameScreen, #joinGameScreen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #222;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .hidden { display: none !important; }

        h1, h2 {
            margin-bottom: 20px;
            color: #4CAF50;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #333;
            color: #fff;
            font-size: 14px;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        button:hover {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .link-button {
            background-color: #2196F3;
            margin-top: 10px;
        }

        .link-button:hover {
            background-color: #0b7dda;
        }

        #gameScreen {
            display: grid;
            grid-template-columns: 1fr 250px 250px;
            gap: 10px;
            height: 100vh;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            background: #222;
            border-radius: 8px;
            padding: 15px;
        }

        .table-area {
            flex: 1;
            background: #0d3d0d;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            overflow: auto;
        }

        .card {
            display: inline-block;
            padding: 8px 12px;
            background-color: #fff;
            color: #000;
            border: 2px solid #333;
            border-radius: 4px;
            margin: 2px;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }

        .card.red { color: red; }
        .card.black { color: black; }
        .card.selected {
            background-color: #FFD700;
            border-color: #000;
            box-shadow: 0 0 8px yellow;
        }

        .card-display {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .hand-area {
            background: #0d3d0d;
            border-radius: 5px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .controls button {
            flex: 1;
            padding: 10px;
            margin: 0;
            font-size: 14px;
        }

        .options-box {
            background: #333;
            border-radius: 5px;
            padding: 15px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .options-box h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .option-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #444;
        }

        .option-item:last-child {
            border-bottom: none;
        }

        .option-label {
            font-size: 13px;
            margin-bottom: 5px;
            color: #ccc;
        }

        .option-item input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            cursor: pointer;
        }

        .option-item select {
            width: 100%;
            padding: 6px;
            font-size: 12px;
        }

        .play-log {
            background: #333;
            border-radius: 5px;
            padding: 15px;
            font-size: 12px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .play-log h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #444;
            color: #aaa;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .current-player {
            background-color: #FFD700;
            color: #000;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        #optionsBtn {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            padding: 0;
            border-radius: 50%;
            background-color: #2196F3;
            font-size: 24px;
            z-index: 500;
        }

        #optionsBtn:hover {
            background-color: #0b7dda;
        }

        .section-title {
            color: #4CAF50;
            font-size: 14px;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        @media (max-width: 1400px) {
            #gameScreen {
                grid-template-columns: 1fr;
            }

            .options-box {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>

<!-- CREATE GAME SCREEN -->
<div id="createGameScreen">
    <h1>President Card Game</h1>

    <div class="form-group">
        <label>Your Name:</label>
        <input type="text" id="playerName" placeholder="Enter your name" value="Player">
    </div>

    <div class="form-group">
        <label>Number of CPUs:</label>
        <select id="cpuCount">
            <option value="1">1 CPU</option>
            <option value="2" selected>2 CPUs</option>
            <option value="3">3 CPUs</option>
        </select>
    </div>

    <div class="section-title">Game Options</div>

    <div class="form-group">
        <label>Number of Players:</label>
        <select id="nplayers">
            <option value="3">3 Players</option>
            <option value="4" selected>4 Players</option>
            <option value="5">5 Players</option>
            <option value="6">6 Players</option>
            <option value="7">7 Players</option>
            <option value="8">8 Players</option>
        </select>
    </div>

    <div class="form-group">
        <label>Number of Decks:</label>
        <select id="num_decks">
            <option value="1" selected>1 Deck</option>
            <option value="2">2 Decks</option>
        </select>
    </div>

    <div class="form-group">
        <label>Run Max Length:</label>
        <select id="run_max">
            <option value="0">Off (No Runs)</option>
            <option value="3">3 Cards</option>
            <option value="4">4 Cards</option>
            <option value="5" selected>5 Cards</option>
            <option value="6">6 Cards</option>
            <option value="7">7 Cards</option>
        </select>
    </div>

    <div class="section-title">Card Options</div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="twos_wild" checked>
            2s Wild
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="black_3_high" checked>
            Black 3s High
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="jack_diamonds_high" checked>
            Jack of Diamonds High
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="bombs" checked>
            Bombs (Triple 6s)
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="wilds_beat_multis" checked>
            Wilds Beat Multis
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="clear_with_2">
            Clear with 2s
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="twos_wild_in_run">
            2s Wild in Runs
        </label>
    </div>

    <div class="form-group">
        <label>Continuous Mode:</label>
        <select id="continuous_mode">
            <option value="ON" selected>On</option>
            <option value="OFF">Off</option>
        </select>
    </div>

    <button onclick="createGame()">Create Game</button>
    <button class="link-button" onclick="showJoinScreen()">Join Existing Game</button>
</div>

<!-- JOIN GAME SCREEN -->
<div id="joinGameScreen" class="hidden">
    <h1>Join Game</h1>

    <div class="form-group">
        <label>Your Name:</label>
        <input type="text" id="joinPlayerName" placeholder="Enter your name" value="Player">
    </div>

    <div class="form-group">
        <label>Table ID:</label>
        <input type="text" id="tableId" placeholder="Enter table ID">
    </div>

    <button onclick="joinGame()">Join Game</button>
    <button class="link-button" onclick="showCreateScreen()">Create New Game</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="hidden">
    <div class="game-area">
        <div class="current-player" id="currentPlayer">Waiting...</div>

        <div style="margin-bottom: 10px;">
            <strong>Table:</strong>
            <div class="card-display" id="tableDisplay"></div>
            <div style="font-size: 12px; margin-top: 5px; color: #aaa;" id="meldType"></div>
        </div>

        <div class="table-area" id="playersDisplay">
            <strong>Players:</strong>
            <div id="playersList"></div>
        </div>

        <div>
            <strong>Your Hand (Click to select):</strong>
            <div class="hand-area" id="handDisplay"></div>
        </div>

        <div class="controls">
            <button onclick="playCards()">Play Selected</button>
            <button onclick="clearSelection()" style="background-color: #f44336;">Clear</button>
            <button onclick="passPlay()" style="background-color: #ff9800;">Pass</button>
        </div>
    </div>

    <!-- OPTIONS PANEL (RIGHT SIDE) -->
    <div class="options-box">
        <h3>‚öôÔ∏è Game Options</h3>

        <div class="section-title">Current Settings</div>
        <div id="currentOptions" style="font-size: 12px; color: #aaa;"></div>

        <div class="section-title">Card Rules</div>

        <div class="option-item">
            <div class="option-label">
                <input type="checkbox" id="opt_twos_wild" checked>
                2s Wild
            </div>
        </div>

        <div class="option-item">
            <div class="option-label">
                <input type="checkbox" id="opt_black_3_high" checked>
                Black 3s High
            </div>
        </div>

        <div class="option-item">
            <div class="option-label">
                <input type="checkbox" id="opt_jd_high" checked>
                Jack of Diamonds High
            </div>
        </div>

        <div class="option-item">
            <div class="option-label">
                <input type="checkbox" id="opt_bombs" checked>
                Bombs (Triple 6s)
            </div>
        </div>

        <div class="option-item">
            <div class="option-label">
                <input type="checkbox" id="opt_wilds_beat_multis" checked>
                Wilds Beat Multis
            </div>
        </div>

        <div class="option-item">
            <div class="section-title">Run Max Length</div>
            <select id="opt_run_max">
                <option value="0">Off</option>
                <option value="3">3 Cards</option>
                <option value="4">4 Cards</option>
                <option value="5" selected>5 Cards</option>
                <option value="6">6 Cards</option>
                <option value="7">7 Cards</option>
            </select>
        </div>

        <div class="option-item">
            <button onclick="testSound()" style="background-color: #4CAF50;">üîä Test Sound</button>
        </div>
    </div>

    <!-- PLAY LOG (RIGHT SIDE) -->
    <div class="play-log">
        <h3>‚ñ∂Ô∏è Play Log</h3>
        <div id="playLog"></div>
    </div>
</div>

<button id="optionsBtn" onclick="toggleOptions()" class="hidden">‚öôÔ∏è</button>

<script>
    const socket = io();

    let currentGame = {
        game_id: null,
        player_id: null,
        name: null,
        state: {}
    };

    function showCreateScreen() {
        document.getElementById('createGameScreen').classList.remove('hidden');
        document.getElementById('joinGameScreen').classList.add('hidden');
    }

    function showJoinScreen() {
        document.getElementById('joinGameScreen').classList.remove('hidden');
        document.getElementById('createGameScreen').classList.add('hidden');
    }

    function createGame() {
        const name = document.getElementById('playerName').value || 'Player';
        const cpus = parseInt(document.getElementById('cpuCount').value);

        const options = {
            nplayers: parseInt(document.getElementById('nplayers').value),
            num_decks: parseInt(document.getElementById('num_decks').value),
            run_max: parseInt(document.getElementById('run_max').value),
            twos_wild: document.getElementById('twos_wild').checked,
            black_3_high: document.getElementById('black_3_high').checked,
            jack_diamonds_high: document.getElementById('jack_diamonds_high').checked,
            bombs: document.getElementById('bombs').checked,
            wilds_beat_multis: document.getElementById('wilds_beat_multis').checked,
            clear_with_2: document.getElementById('clear_with_2').checked,
            twos_wild_in_run: document.getElementById('twos_wild_in_run').checked,
            continuous_mode: document.getElementById('continuous_mode').value
        };

        socket.emit('create', {
            name: name,
            cpus: cpus,
            ...options
        });
    }

    function joinGame() {
        const name = document.getElementById('joinPlayerName').value || 'Player';
        const table_id = document.getElementById('tableId').value;

        if (!table_id) {
            alert('Please enter a table ID');
            return;
        }

        socket.emit('join', {
            name: name,
            table_id: table_id
        });
    }

    function playCards() {
        const selected = document.querySelectorAll('.card.selected');
        if (selected.length === 0) {
            alert('Select cards to play');
            return;
        }

        const cards = Array.from(selected).map(c => c.textContent);
        socket.emit('play', {
            game_id: currentGame.game_id,
            cards: cards
        });
    }

    function clearSelection() {
        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
    }

    function passPlay() {
        socket.emit('pass', {
            game_id: currentGame.game_id
        });
    }

    function testSound() {
        // Placeholder for sound test
        console.log('Sound test clicked');
    }

    function toggleOptions() {
        // Placeholder
    }

    function displayCard(card) {
        const suits = {'‚ô†': 'black', '‚ô•': 'red', '‚ô¶': 'red', '‚ô£': 'black'};
        const suit = card.slice(-1);
        const suitClass = suits[suit] || 'black';
        return `<span class="card ${suitClass}" onclick="toggleCardSelect(this)">${card}</span>`;
    }

    function toggleCardSelect(elem) {
        elem.classList.toggle('selected');
    }

    function updateDisplay(state) {
        if (!state) return;

        // Update table
        const tableDisplay = document.getElementById('tableDisplay');
        tableDisplay.innerHTML = (state.table || []).map(c => displayCard(c)).join('');

        // Update current player
        const currentPlayer = document.getElementById('currentPlayer');
        currentPlayer.textContent = `Current: ${state.current_player || 'Waiting...'}${state.current_is_cpu ? ' (CPU)' : ''}`;

        // Update players
        const playersList = document.getElementById('playersList');
        if (state.players) {
            playersList.innerHTML = state.players.map(p => 
                `<div style="margin: 5px 0; padding: 5px; background: #444; border-radius: 3px;">
                    ${p.name} (${p.cards} cards) ${p.is_cpu ? '(CPU)' : ''} - ${p.role}
                </div>`
            ).join('');
        }

        // Update hand
        const handDisplay = document.getElementById('handDisplay');
        handDisplay.innerHTML = (state.players.find(p => p.id === currentGame.player_id)?.hand || [])
            .map(c => displayCard(c)).join('');

        // Update options display
        if (state.options) {
            const opts = state.options;
            const optDisplay = `
                Players: ${opts.nplayers}<br>
                Decks: ${opts.num_decks}<br>
                Run Max: ${opts.run_max}<br>
                2s Wild: ${opts.twos_wild ? '‚úì' : '‚úó'}<br>
                Black 3 High: ${opts.black_3_high ? '‚úì' : '‚úó'}<br>
                JD High: ${opts.jack_diamonds_high ? '‚úì' : '‚úó'}<br>
                Bombs: ${opts.bombs ? '‚úì' : '‚úó'}<br>
                Wilds Beat Multis: ${opts.wilds_beat_multis ? '‚úì' : '‚úó'}
            `;
            document.getElementById('currentOptions').innerHTML = optDisplay;
        }
    }

    socket.on('game_created', (data) => {
        currentGame.game_id = data.game_id;
        currentGame.player_id = socket.id;

        document.getElementById('createGameScreen').classList.add('hidden');
        document.getElementById('joinGameScreen').classList.add('hidden');
        document.getElementById('gameScreen').classList.remove('hidden');

        updateDisplay(data.state);
    });

    socket.on('state', (state) => {
        currentGame.state = state;
        updateDisplay(state);
    });

    socket.on('error', (data) => {
        alert('Error: ' + data.msg);
    });
</script>

</body>
</html>
